I"b!<h3 id="overview">Overview</h3>
<p>Airflow is a platform to programmatically author, schedule and monitor workflows. Use Airflow to author workflows as Directed Acyclic Graphs (DAGs) of tasks. The Airflow scheduler executes your tasks on an array of workers while following the specified dependencies. Rich command line utilities make performing complex surgeries on DAGs a snap. The rich user interface makes it easy to visualize pipelines running in production, monitor progress, and troubleshoot issues when needed.</p>

<p>When workflows are defined as code, they become more maintainable, versionable, testable, and collaborative.</p>

<h3 id="principles">Principles</h3>
<ul>
  <li><strong>Dynamic</strong>: Airflow pipelines are configuration as code (Python), allowing for dynamic pipeline generation. This allows for writing code that instantiates pipelines dynamically.</li>
  <li><strong>Extensible</strong>: Easily define your own operators, executors and extend the library so that it fits the level of abstraction that suits your environment.</li>
  <li><strong>Elegant</strong>: Airflow pipelines are lean and explicit. Parameterizing your scripts is built into the core of Airflow using the powerful Jinja templating engine.</li>
  <li><strong>Scalable</strong>: Airflow has a modular architecture and uses a message queue to orchestrate an arbitrary number of workers. Airflow is ready to scale to infinity.</li>
</ul>

<h3 id="beyond-the-horizon">Beyond the Horizon</h3>
<p>Airflow is not a data streaming solution. Tasks do not move data from one to the other (though tasks can exchange metadata!). Airflow is not in the Spark Streaming or Storm space, it is more comparable to Oozie or Azkaban.</p>

<p>Workflows are expected to be mostly static or slowly changing. You can think of the structure of the tasks in your workflow as slightly more dynamic than a database structure would be. Airflow workflows are expected to look similar from a run to the next, this allows for clarity around unit of work and continuity.</p>

<h3 id="installation">Installation</h3>
<h4 id="getting-airflow">Getting Airflow</h4>
<p>The easiest way to install the latest stable version of Airflow is with pip:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip <span class="nb">install </span>apache-airflow
</pre></td></tr></tbody></table></code></pre></div></div>
<p>You can also install Airflow with support for extra features like <code class="language-plaintext highlighter-rouge">gcp</code> or <code class="language-plaintext highlighter-rouge">postgres</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pip <span class="nb">install </span>apache-airflow[gcp,postgres]
</pre></td></tr></tbody></table></code></pre></div></div>

<h4 id="initiating-airflow-database">Initiating Airflow Database</h4>
<p>Airflow requires a database to be initiated before you can run tasks. If you’re just experimenting and learning Airflow, you can stick with the default SQLite option. If you don’t want to use SQLite, then take a look at Initializing a Database Backend to setup a different database.</p>

<p>After configuration, you’ll need to initialize the database before you can run tasks:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>airflow initdb
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="its-a-dag-definition-file">It’s a DAG Definition File</h3>
<p>One thing to wrap your head around (it may not be very intuitive for everyone at first) is that this Airflow Python script is really just a configuration file specifying the DAG’s structure as code. The actual tasks defined here will run in a different context from the context of this script. Different tasks run on different workers at different points in time, which means that this script cannot be used to cross communicate between tasks. Note that for this purpose we have a more advanced feature called <code class="language-plaintext highlighter-rouge">XCom</code>.</p>

<p>People sometimes think of the DAG definition file as a place where they can do some actual data processing - that is not the case at all! The script’s purpose is to define a DAG object. It needs to evaluate quickly (seconds, not minutes) since the scheduler will execute it periodically to reflect the changes if any.</p>

<p>In Airflow all workflows are DAGs. A Dag consists of operators. An operator defines an individual task that needs to be performed. There are different types of operators available( As given on Airflow Website):</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">BashOperator</code> - executes a bash command</li>
  <li><code class="language-plaintext highlighter-rouge">PythonOperator</code> - calls an arbitrary Python function</li>
  <li><code class="language-plaintext highlighter-rouge">EmailOperator</code> - sends an email</li>
  <li><code class="language-plaintext highlighter-rouge">SimpleHttpOperator</code> - sends an HTTP request</li>
  <li><code class="language-plaintext highlighter-rouge">MySqlOperator</code>, <code class="language-plaintext highlighter-rouge">SqliteOperator</code>, <code class="language-plaintext highlighter-rouge">PostgresOperator</code>, <code class="language-plaintext highlighter-rouge">MsSqlOperator</code>, <code class="language-plaintext highlighter-rouge">OracleOperator</code>, <code class="language-plaintext highlighter-rouge">JdbcOperator</code>, etc. - executes a SQL command</li>
  <li><code class="language-plaintext highlighter-rouge">Sensor</code> - waits for a certain time, file, database row, S3 key, etc</li>
</ul>

<h3 id="how-to-run-airflow-and-scheduler">How to Run Airflow and Scheduler</h3>
<p>It’s pretty easy to run the Apache Airflow and Scheduler. First, open your terminal and follow below commands!</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c"># airflow needs a home, ~/airflow is the default,</span>
<span class="c"># but you can lay foundation somewhere else if you prefer</span>
<span class="c"># (optional)</span>
<span class="nb">export </span><span class="nv">AIRFLOW_HOME</span><span class="o">=</span>~/airflow

<span class="c"># initialize the database</span>
airflow initdb

<span class="c"># start the web server, default port is 8080</span>
airflow webserver <span class="nt">-p</span> 8080

<span class="c"># start the scheduler</span>
airflow scheduler

<span class="c"># visit localhost:8080 in the browser and enable the example dag in the home page</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Upon running these commands, Airflow will create the <code class="language-plaintext highlighter-rouge">$AIRFLOW_HOME</code> folder and lay an “airflow.cfg” file with defaults that get you going fast. You can inspect the file either in <code class="language-plaintext highlighter-rouge">$AIRFLOW_HOME/airflow.cfg</code>, or through the UI in the <code class="language-plaintext highlighter-rouge">Admin-&gt;Configuration</code> menu. The PID file for the webserver will be stored in <code class="language-plaintext highlighter-rouge">$AIRFLOW_HOME/airflow-webserver.pid</code> or in <code class="language-plaintext highlighter-rouge">/run/airflow/webserver.pid</code> if started by systemd.</p>

<p>For the next post, I will do explain how could I define my pipeline for Covid-19 data using web scraping over Kompas news. Please stay tune!</p>

<h3 id="sources">Sources</h3>
<p><a target="_blank" href="https://airflow.readthedocs.io/en/stable/i" class="btn btn-danger">Airflow Documentation</a> <a target="_blank" href="https://towardsdatascience.com/getting-started-with-apache-airflow-df1aa77d7b1b#:~:text=Airflow%20is%20a%20platform%20to,while%20following%20the%20specified%20dependencies." class="btn btn-warning">Towards Data Science</a></p>
:ET